$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)
require 'gprs'

require 'minitest/autorun'

def parse_report_single(log = true)
  # Unit ID: 4 (sample unit)
  packet = [0x28,0xC5,0x10,0xA8,0xA0,0xB1,0x85,0x22,0x1F,0x4,0xB7,0x95,0x3F,0x60,0x25,0x9E,0x0,0x3,0x55,0x66,0x6,0x1F,0x78,0x90,0x2,0x6F,0x9F,0x1,0x24,0x4,0x0,0x0,0x0,0x1,0x95,0x29]
  if log
    puts ""
    puts "# Parsing 1 packet..."
  end
  report = Gprs.parse_report(packet)
  if log
    puts report
    puts ""
  end
end

def parse_report_multiple(log = true)
  # Unit ID: 4 (sample unit)
  packets = [
    [0x28,0xC6,0x10,0xA8,0xA0,0xC1,0x93,0x22,0x1F,0x4,0xAD,0x95,0x3F,0x5C,0x25,0x9E,0x0,0x3,0x54,0x66,0x6,0x1D,0x78,0x90,0x2,0x6F,0x9F,0x1,0x24,0x4,0x0,0x0,0x0,0x1,0xD5,0x29],
    [0x28,0xC7,0x10,0xA8,0xA0,0xD1,0xA1,0x22,0x1F,0x4,0xB3,0x95,0x3F,0x5B,0x25,0x9E,0x0,0x3,0x60,0x90,0x7B,0x1F,0x78,0x90,0x2,0x6F,0x9F,0x1,0x24,0x4,0x0,0x0,0x0,0x1,0x52,0x29],
    [0x28,0x81,0x10,0xA8,0x0,0x0,0x0,0x0,0x0,0x4,0x0,0x0,0x80,0x0,0x0,0x0,0x0,0x10,0x88,0x5D,0x2,0x6F,0x9F,0x1,0x24,0x4,0x0,0x0,0x0,0x1,0xAA,0x29],
    [0x28,0x82,0x10,0xA8,0x20,0x59,0xB0,0x22,0x1F,0x4,0xB5,0x95,0x3F,0x5D,0x25,0x9E,0x0,0x10,0x8D,0x56,0x2,0x6F,0x9F,0x1,0x24,0x4,0x0,0x0,0x0,0x1,0x2A,0x29],
    [0x28,0x81,0x10,0xA8,0x0,0x0,0x0,0x0,0x0,0x4,0x0,0x0,0x80,0x0,0x0,0x0,0x0,0x10,0x88,0x50,0x2,0x6F,0x9F,0x1,0x24,0x4,0x0,0x0,0x0,0x1,0xA7,0x29]
  ]

  if log
    puts ""
    puts "# Parsing #{packets.length} packets..."
  end
  packets.each do |packet|
    report = Gprs.parse_report(packet)
    if log
      puts report
      puts ""
    end
  end
end